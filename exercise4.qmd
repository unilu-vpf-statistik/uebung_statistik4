---
title: "Übung 4 - Datenaufbereitung I: Tidy Data & Umkodierung"
subtitle: "FS 2026"
author: "Gidon Frischkorn"
format:
  html:
    css: styles.css
    include-after-body: webex.js
filters:
  - webr
tbl-colwidths: [60,40]
---

```{r preparation}
#| include: false
library(exams)
library(exams2forms)
library(here)

exam_files <- list.files(here("questions_uebung4"), pattern = "*.Rmd", full.names = TRUE)
shuffled_questions <- sample(exam_files)
```

## Wiederholung & Vertiefung: Tidy Data & Umkodierung

In dieser Übung beschäftigen wir uns mit zwei grundlegenden Schritten der Datenaufbereitung: der Herstellung einer einheitlichen Datenstruktur nach dem **Tidy-Data-Prinzip** und der **Umkodierung** von Variablen, damit Werte inhaltlich konsistent und interpretierbar sind.

Wenn Sie die Inhalte der Vorlesung nochmal vertiefen wollen, empfehle ich Ihnen folgende Videos:

- [Tidy Data and tidyr Explained](https://www.youtube.com/watch?v=1ELALQlO-yM)
- [pivot_longer and pivot_wider in R (tidyr)](https://www.youtube.com/watch?v=D48JHU4llkk)

## Tidy Data Prinzipien

Ein Datensatz ist **tidy** wenn:

1. **Jede Variable ist eine Spalte** — eine Variable, eine Spalte, keine Ausnahmen
2. **Jede Beobachtung ist eine Zeile** — ein Messzeitpunkt oder eine Person, eine Zeile
3. **Jede Beobachtungseinheit ist eine eigene Tabelle** — verschiedene Einheiten (z. B. Personen und Schulen) werden nicht gemischt

Häufige Verletzungen:

- Spaltennamen sind Werte statt Variablennamen (z. B. `score_t1`, `score_t2`, `score_t3`)
- Mehrere Variablen in einer Spalte (z. B. `"KG_m"` für Gruppe und Geschlecht)

| Ziel | Funktion |
|---|---|
| Breites → langes Format | `pivot_longer()` |
| Langes → breites Format | `pivot_wider()` |

## Umkodierung

Auch wenn die Struktur stimmt, können die **Werte** inhaltlich problematisch sein. Typische Situationen:

- **Inkonsistente Kodierungen**: `"KG"`, `"Kontrolle"` und `"control"` meinen dasselbe — R sieht drei verschiedene Gruppen
- **Implizite fehlende Werte**: `"999"` oder `"-"` statt `NA`
- **Falsche Skalenrichtung**: Eine Item-Skala ist umgekehrt gepolt

Die Funktion `case_when()` aus dem `dplyr`-Paket ist das Hauptwerkzeug für Umkodierungen.

## Übungen

Beantworten Sie die folgenden Fragen zu Tidy Data und Umkodierung.

Wie in den Übungen finden Sie unter den Übungsfragen die `webr` Konsole, die Ihnen das Schreiben und Durchführen von R Code direkt auf der Website ermöglicht. Wenn viele Studierenden die Übungen parallel machen, dann kann es sein, dass `webr` langsam wird.

> Um den Code den Sie geschrieben haben auszuführen drücken Sie entweder `Run Code`, damit der gesamte Code ausgeführt wird. Alternativ können Sie auch einzelne Zeilen ausführen, indem sie <kbd>CTRL</kbd>+<kbd>Enter</kbd> (Windows) oder <kbd>CMD</kbd>+<kbd>Enter</kbd> (Mac) drücken.

```{r print_questions}
#| echo: false
#| message: false
#| results: "asis"
exams2forms(shuffled_questions, mathjax = TRUE)
```

```{webr-r}
# Herunterladen des Datensatzes
base_url <- "https://unilu-vpf-statistik.github.io/uebung_statistik4/daten/"
download.file(paste0(base_url, "WM_Fragebögen.csv"), "WM_Fragebögen.csv")
download.file(paste0(base_url, "Lab_Kodierung.dat"), "Lab_Kodierung.dat")

# Laden der benötigten Pakete
library(dplyr)
library(tidyr)

# Daten einlesen
wm_daten <- read.csv2("WM_Fragebögen.csv")
lab_daten <- read.table("Lab_Kodierung.dat", header = TRUE, sep = "\t")

# --- Aufgabe 1: Tidy Data ---
# Der Datensatz wm_daten enthält mehrere Fragebogen-Items in separaten Spalten.
# Schauen Sie sich die Spalten an:
head(wm_daten)

# Identifizieren Sie Spalten, die Werte eines Messzeitpunkts oder einer Skala
# repräsentieren. Konvertieren Sie diese mit pivot_longer() ins lange Format.
# Beispiel (passen Sie die Spaltennamen an):
# wm_lang <- wm_daten |>
#   pivot_longer(cols = c(spalte1, spalte2),
#                names_to = "variable",
#                values_to = "wert")

# --- Aufgabe 2: Umkodierung ---
# Prüfen Sie die Kodierungen der Gruppe-Variable in lab_daten:
table(lab_daten$group_raw)

# Kodieren Sie inkonsistente Werte mit case_when() um:
# lab_daten <- lab_daten |>
#   mutate(gruppe = case_when(
#     group_raw %in% c("KG", "Kontrolle", "control") ~ "Kontrolle",
#     group_raw %in% c("EG", "Experimental") ~ "Experimental",
#     TRUE ~ NA_character_
#   ))
```

> Nutzen Sie eine [Suchmaschine](https://unilu-vpf-statistik.github.io/uebung_statistik4/about.html#suchmaschinen), wenn Sie nicht wissen welche Funktionen Ihnen ein bestimmtes Ergebnis liefern.

------------------------------------------------------------------------

[![](images/Logo_UniLu.png){fig-align="center" width="300"}](https://www.unilu.ch/fakultaeten/vpf/uebersicht/)
