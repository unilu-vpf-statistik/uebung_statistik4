---
title: "Übung 5 - Datenaufbereitung II: Fehlende Werte & Ausreisser"
subtitle: "FS 2026"
author: "Gidon Frischkorn"
format:
  html:
    css: styles.css
    include-after-body: webex.js
filters:
  - webr
tbl-colwidths: [60,40]
---

```{r preparation}
#| include: false
library(exams)
library(exams2forms)
library(here)

exam_files <- list.files(here("questions_uebung5"), pattern = "*.Rmd", full.names = TRUE)
shuffled_questions <- sample(exam_files)
```

## Wiederholung & Vertiefung: Fehlende Werte & Ausreisser

In dieser Übung beschäftigen wir uns mit zwei häufigen Datenproblemen: **fehlenden Werten** und **Ausreissern**. Beide können Analysen systematisch verzerren — weshalb es wichtig ist, sie zu erkennen, zu verstehen und begründet mit ihnen umzugehen.

Wenn Sie die Inhalte der Vorlesung nochmal vertiefen wollen, empfehle ich Ihnen folgende Videos:

- [Missing Data in R — Types and How to Handle Them](https://www.youtube.com/watch?v=GXHFM1vVGq8)
- [Outlier Detection in R](https://www.youtube.com/watch?v=TFwVOOZ-k6I)

## Mechanismen fehlender Werte

Nicht alle fehlenden Werte sind gleich. Der **Mechanismus** des Fehlens bestimmt, wie stark eine Analyse verzerrt wird:

| Mechanismus | Bedeutung | Beispiel |
|---|---|---|
| **MCAR** (Missing Completely At Random) | Fehlen ist unabhängig von allen Variablen | Technischer Ausfall beim Speichern |
| **MAR** (Missing At Random) | Fehlen hängt von anderen bekannten Variablen ab | Schlafmangel → fehlende Konzentrationswerte |
| **MNAR** (Missing Not At Random) | Fehlen hängt vom fehlenden Wert selbst ab | Hoher Stress → keine Stressbewertung abgegeben |

Nur MCAR ist für die meisten Analysen unproblematisch. MAR und MNAR erfordern besondere Behandlung (z. B. multiple Imputation, Modellierung des Fehlmechanismus).

## Ausreisser erkennen

Ausreisser sind Werte, die ungewöhnlich weit vom Zentrum der Verteilung abweichen. Zwei gängige Kriterien:

**IQR-Regel:**

- Untere Grenze: Q1 − 1,5 × IQR
- Obere Grenze: Q3 + 1,5 × IQR
- In R: `Q1 <- quantile(x, 0.25); Q3 <- quantile(x, 0.75); IQR_val <- IQR(x)`

**z-Score-Kriterium:**

- z = (x − Mittelwert) / Standardabweichung
- Ausreisser: |z| > 3
- In R: `z_scores <- scale(x); which(abs(z_scores) > 3)`

Ausreisser müssen nicht zwingend entfernt werden. Stattdessen sollten Sie prüfen: Ist der Wert ein Messfehler? Oder ein echter extremer Wert? Die Entscheidung muss begründet und dokumentiert werden.

## Übungen

Beantworten Sie die folgenden Fragen zu fehlenden Werten und Ausreissern.

Wie in den Übungen finden Sie unter den Übungsfragen die `webr` Konsole, die Ihnen das Schreiben und Durchführen von R Code direkt auf der Website ermöglicht. Wenn viele Studierenden die Übungen parallel machen, dann kann es sein, dass `webr` langsam wird.

> Um den Code den Sie geschrieben haben auszuführen drücken Sie entweder `Run Code`, damit der gesamte Code ausgeführt wird. Alternativ können Sie auch einzelne Zeilen ausführen, indem sie <kbd>CTRL</kbd>+<kbd>Enter</kbd> (Windows) oder <kbd>CMD</kbd>+<kbd>Enter</kbd> (Mac) drücken.

```{r print_questions}
#| echo: false
#| message: false
#| results: "asis"
exams2forms(shuffled_questions, mathjax = TRUE)
```

```{webr-r}
# Herunterladen des Datensatzes
base_url <- "https://unilu-vpf-statistik.github.io/uebung_statistik4/daten/"
download.file(paste0(base_url, "WM_Fragebögen.csv"), "WM_Fragebögen.csv")

# Laden der benötigten Pakete
library(dplyr)

# Daten einlesen
wm_daten <- read.csv2("WM_Fragebögen.csv")

# --- Aufgabe 1: Fehlende Werte ---
# Anzahl fehlender Werte pro Spalte:
colSums(is.na(wm_daten))

# Welche Zeilen haben fehlende Werte?
# which(!complete.cases(wm_daten))

# Überlegen Sie: Fehlen die Werte in wm_score oder stress_rating eher
# nach MCAR, MAR oder MNAR? Notieren Sie Ihre Begründung als Kommentar.

# --- Aufgabe 2: Ausreisser erkennen ---
# IQR-Regel für wm_score:
x <- wm_daten$wm_score
Q1 <- quantile(x, 0.25, na.rm = TRUE)
Q3 <- quantile(x, 0.75, na.rm = TRUE)
IQR_val <- IQR(x, na.rm = TRUE)
untere_grenze <- Q1 - 1.5 * IQR_val
obere_grenze  <- Q3 + 1.5 * IQR_val
cat("Ausreisser-Grenzen (IQR):", untere_grenze, "bis", obere_grenze, "\n")
sum(x < untere_grenze | x > obere_grenze, na.rm = TRUE)

# z-Score-Kriterium:
z_scores <- scale(x)
sum(abs(z_scores) > 3, na.rm = TRUE)
```

> Nutzen Sie eine [Suchmaschine](https://unilu-vpf-statistik.github.io/uebung_statistik4/about.html#suchmaschinen), wenn Sie nicht wissen welche Funktionen Ihnen ein bestimmtes Ergebnis liefern.

------------------------------------------------------------------------

[![](images/Logo_UniLu.png){fig-align="center" width="300"}](https://www.unilu.ch/fakultaeten/vpf/uebersicht/)
